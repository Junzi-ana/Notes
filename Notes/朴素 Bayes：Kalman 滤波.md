---
{}
---
#SmallEssays/统计学习 #FromDeepSeek 

考虑这样一个线性系统
$$
x_{k}=F_{k}x_{k-1}+w_{k}
$$
$x_{k}$ 是 $k$ 时刻的状态向量，$F_{k}$ 是状态转移矩阵，$w_{k}$ 是过程噪声，假定其服从 $N(0,~Q_{k})$ 。

实际中我们往往不能准确取得系统状态 $x_{k}$，而只能取得其测量值 $z_{k}$ ，满足
$$
z_{k}=H_{k}x_{k}+v_{k}
$$
其中 $v_{k}$ 是观测噪声，服从 $N(0,~R_{k})$ 且与 $w_{k}$ 独立，$H$ 是观测矩阵，其未必是满秩的，这意味着可能我们不能测量到所有系统状态，会损失一些信息。

介绍完模型了，现在我们的问题是在给定 $z_{1}, \cdots,~ z_{k}$ 的观测值的条件下，预测此时刻的真值 $x_{k}$ 和下一步的真值 $x_{k+1}$ 。假如 $H_{k}$ 可逆，那么最简单粗暴的估计是用 $H^{-1}_{k}z_{k}$ 估计 $x_{k}$，然后用 $F_{k}H^{-1}_{k}z_{k}$ 去估计 $x_{k+1}$ 。倘若每个观测之间是独立同分布的，那这样做自然没有问题，然而这里存在很明显的前后相依关系，明明有 $k$ 个观测值，在估计时却只用 $1$ 个，那毫无疑问会损失信息，从而降低精度。

我们尝试使用 [[Bayes 统计：基本原理与例子|Bayes 统计]]的方法，推导出一个递归的表达式。假设已有 $\hat{x}_{k-1|k-1}$，为给定 $z_{1}, \cdots,~ z_{k-1}$ 时对 $x_{k-1}$ 的估计，那么有**先验状态预测**
$$
\hat{x}_{k|k-1}=F_{k}\hat{x}_{k-1|k-1}
$$
记 $\hat{x}_{k-1|k-1}$ 有协方差阵 $P_{k-1|k-1}$，那么同样也可以得到**先验协方差预测**
$$
P_{k|k-1}=F_{k}P_{k-1|k-1}F_{k}^{T}+Q_{k}
$$
现在我们要获得 $\hat{x}_{k|k}$，目前 $z_{1}, \cdots,~ z_{k-1}$ 都已经用上了，只需要再对于 $z_{k}$ 求后验分布即可，于是由 Bayes 公式得
$$
p(x_{k}|z_{k};\hat{x}_{k|k-1})\propto p(z_{k}|x_{k})p(x_{k};\hat{x}_{k|k-1})
$$
其中先验分布 $x_{k}\sim N(\hat{x}_{k|k-1},~P_{k|k-1})$ 。取对数可得，要最大化后验概率实际上需要最小化如下损失函数
$$
\begin{align}
L(x_{k})&=\frac{1}{2}(x_{k}-\hat{x}_{k|k-1})^{T}P^{-1}_{k|k-1}(x_{k}-\hat{x}_{k|k-1})\\&+\frac{1}{2}(z_{k}-H_{k}x_{k})^{T}R_{k}^{-1}(z_{k}-H_{k}x_{k})
\end{align}

$$
经过一系列繁琐的矩阵运算，可以求得极小值点为
$$
\hat{x}_{k|k}=(P^{-1}_{k|k-1}+H_{k}^{T}R_{k}^{-1}H_{k})^{-1}(P^{-1}_{k|k-1}\hat{x}_{k|k-1}+H_{k}^{T}R_{k}^{-1}z_{k})
$$
这便是 $x_{k}$ 的 MAP 估计。

当然这个式子还可以进一步化简。构造矩阵 $\begin{bmatrix}P^{-1}_{k|k-1} & -H^{T}_{k} \\ H_{k} & R_{k}\end{bmatrix}$，利用[[条件分布与 Schur 补公式#^a39c43|分块矩阵求逆定理]]，记
$$
\begin{align}
K_{k}&=P_{k|k-1}H_{k}^{T}(R+H_{k}P_{k|k-1}H_{k}^{T})^{-1}\\
&=(P^{-1}_{k|k-1}+H_{k}^{T}R_{k}^{-1}H_{k})^{-1}H_{k}^{T}R_{k}^{-1}
\end{align}
$$
称为 **Kalman 增益**，仅由 $z_{1}, \cdots,~ z_{k-1}$ 和已知量确定。借此可以给出一个**后验状态更新**的较为简单形式
$$
\hat{x}_{k|k}=\hat{x}_{k|k-1}+K_{k}(z_{k}-H_{k}\hat{x}_{k|k-1})
$$
以及对应的**后验协方差更新**
$$
P_{k|k}=(I-K_{k}H_{k})P_{k|k-1}
$$

综合以上内容，我们导出了 **Kalman 滤波**算法，它分为以下四步：
1. 先验状态预测 $\hat{x}_{k|k-1}=F_{k}\hat{x}_{k-1|k-1}$
2. 先验协方差预测 $P_{k|k-1}=F_{k}P_{k-1|k-1}F_{k}^{T}+Q_{k}$
3. 后验状态更新 $\hat{x}_{k|k}=\hat{x}_{k|k-1}+K_{k}(z_{k}-H_{k}\hat{x}_{k|k-1})$
4. 后验协方差更新 $P_{k|k}=(I-K_{k}H_{k})P_{k|k-1}$
其中较为值得一提的是状态更新步被写成了预测值 $\hat{x}_{k|k-1}$ 与校正值 $z_{k}-H_{k}\hat{x}_{k|k-1}$ 的线性组合，这样得到的估计值综合考虑了模型预测的误差与实际观测产生的误差，而 $K_{k}$ 就是使得这个综合误差最小化的系数。

增益 $K$ 主要受到 $Q$ 和 $R$ 的影响。$Q$ 较大表明系统本身有较大的不确定性，此时应该更依赖观测值，即 $K$ 较大；反之 $R$ 较大表明观测具有较大的不确定性，此时应该更依赖预测值，即 $K$ 较小。

---
*2025-11-21*