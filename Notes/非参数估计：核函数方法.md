---
{}
---
#SmallEssays/数理统计

如何估计总体的概率密度？这是一个非参数估计问题，当完成了抽样后，我们会考虑绘制频率直方图，并以此（一个阶梯函数）作为概率密度的估计。在[[非参数估计：数理统计基本定理]]中，我们已经建立了对分布函数 $F$ 的估计 $\widehat{F}$ 及极限性质的分析，只需要令
$$
\hat{p}(x)=\frac{1}{2nh}\left( \widehat{F}(x+h) -\widehat{F}(x-h)\right) 
$$
就能得到概率密度 $p$ 的估计。

毫无疑问，这样估计会出现很多问题，例如数值导数不稳定、对样本有要求、不光滑甚至不连续等等。为此，我们必须寻找一些更合适的估计方法。

但无论如何，这个估计还是能给我们很多启发。将 $\hat{p}(x)$ 写成如下形式
$$
\hat{p}(x)=\frac{1}{2nh}\sum^{n}_{i=1} \mathbb{1}_{\{x-h\leq  X_{i}\leq x+h \}}
$$
我们可以发现，$\hat{p}$ 性质差的本质是求和号里的示性函数 $\mathbb{1}$ 性质差。从分析的角度看，它是间断的；从统计的角度看，在估计一个具体的点 $p(x)$ 时，实际上只用到了它周围很小范围 $[x-h,x+h]$ 的样本信息。若把它换成一个更一般的函数，就有
$$
\hat{p}^{R}(x)=\frac{1}{nh}\sum^{n}_{i=1} K\left( \frac{x-X_{i}}{h} \right) 
$$
称为 **Rosenblatt 估计**，或核函数估计，其中 $K(u)$ 是**核函数**，应当满足
1. $\displaystyle K(u)\geq0,~\int_{\mathbb{R}} K(u)  \; \mathrm{d}u=1,~\int_{\mathbb{R}}u K(u)  \; \mathrm{d}u=0$
2. $\displaystyle\int_{\mathbb{R}}u^{2} K(u)  \; \mathrm{d}u\neq0,~\int_{\mathbb{R}}u^{4} K(u)  \; \mathrm{d}u<\infty$
3. 不妨总假定 $K$ 是偶函数
特别地，当 $K(u)=\dfrac{1}{2}\mathbb{1}_{\{ -1\leq u\leq1 \}}$ 时就是前述的 $\hat{p}$ 。

有了估计，接下去就需要去评价这个估计的好坏，主要依赖两个评价指标：偏差和方差。但由于 $\hat{p}$ 是一个函数，所以我们分别从逐点意义和平均意义上来考虑。

方差总是比较好估计，假定 $p$ 有界 $p_{m}$ ，$K\in L^{2}$。
$$
\begin{align}
\text{Var}(\hat{p}(x_{0}))&=\frac{1}{nh^{2}}\text{Var}(K \big(\frac{X_{i}-x_{0}}{h}\big) )\\
&\leq \frac{1}{nh^{2}}\mathbb{E}K^{2}\big( \frac{X_{i}-x_{0}}{h} \big)\\
{\scriptsize (u\leftarrow x_{0}+uh)}  &=\frac{1}{nh}\int_{\mathbb{R}} K^{2}(u) p(x_{0}+uh)\; \mathrm{d}t \\
&\leq \frac{p_{m}}{nh}\left\| K \right\| ^{2}
\end{align}
$$
建立积分均方误差连 $p$ 有界都不需要
$$
\begin{align}
 \int_{\mathbb{R}}\text{Var}(\hat{p} (x))  \; \mathrm{d}x \leq \frac{1}{nh}\int_{\mathbb{R}} K^{2}(u) \; \mathrm{d}u\int_{\mathbb{R}} p(x+uh) \; \mathrm{d}x  \leq \frac{1}{nh}\left\| K \right\|^{2} 
\end{align}
$$

然而，偏差比较难以估计，需要引入一些额外的条件。

**定义** 设 $l=[\beta]$，若 $f$ 的 $l$ 阶导数 $f^{(l)}$ 是 $\beta-l$ 阶 Hölder 连续，称 $f$ 属于 $\beta$ 阶 Hölder 类，记作 $f\in\Sigma^{\beta}$ 

**定义** 若 $K(u)$ 满足
$$
\int_{\mathbb{R}} K(u)  \; \mathrm{d}u=1,\quad \int_{\mathbb{R}}u^{j} K(u)  \; \mathrm{d}u=0,\quad j=1, \cdots,l
$$
此时**不要求 $K$ 的非负性**，则称 $K$ 是 $l$ 阶核

> [!note]-
> $l$ 阶核可以通过正交多项式来构造，例如 $K(u)=\frac{9}{8}(1-\frac{5}{3}u^{2})$ 是 $2$ 阶核。

现在可以估计偏差了。若 $K$ 是 $l$ 阶核，$p \in \Sigma^{\beta}$
$$
\begin{align}
\left| \text{bias}(\hat{p}(x_{0})) \right|&=\left| \mathbb{E}\hat{p}(x_{0})-p(x_{0}) \right|\\
&=\left| \frac{1}{h}\int_{\mathbb{R}}  K(u)\big( p(x_{0}-uh)-p(x_{0}) \big)\; \mathrm{d}x   \right| \\
{\scriptsize(\text{Taylor, K is $l$-kernel})}&=\left| \int_{\mathbb{R}}K(u) \frac{p^{(l)}(\xi)}{l!} (uh)^{l} \; \mathrm{d}x  \right| \\
{\scriptsize(\text{K is $l$-kernel})}&=\left| \int_{\mathbb{R}}K(u) \Big( \frac{p^{(l)}(\xi)}{l!} (uh)^{l}-\frac{p^{(l)}(x_{0})}{l!} (uh)^{l} \Big)  \; \mathrm{d}x  \right| \\
{\scriptsize (p \in \Sigma^{\beta})}&\leq \int_{\mathbb{R}} \left| K(u) \right| \frac{|uh|^{l}}{l!}L|uh|^{\beta-l} \; \mathrm{d}u\\
&\leq  \frac{Lh^{\beta}}{l!}\int_{\mathbb{R}} |u^{\beta}||K(u)|  \; \mathrm{d}u 
\end{align}
$$
类似地，也可以估计积分平方偏差，同样需要添加一些条件。

**定义** 设 $l=[\beta],~L>0$，若 $\left\| f^{(l)}(x+t)-f^{(l)}(x) \right\|\leq L|t|^{\beta-l}$，则称 $f$ 属于 **$\beta$ 阶 Nikol'ski 类**，记作 $f\in \mathcal{H}^{\beta}$

**引理（广义 Minkovski 不等式）** 设 $g:\mathbb{R}^{2}\to \mathbb{R}$，成立不等式
$$
	\int_{\mathbb{R}} \left\| g(\cdot,x) \right\|^{2} \; \mathrm{d}x\leq \left( \int_{\mathbb{R}} \left\| g(u,\cdot) \right\|  \; \mathrm{d}u  \right) ^{2}
$$

于是同样假定 $K$ 是 $l$ 阶核，但此时令 $p \in \mathcal{H}^{\beta}$。我们直接来到逐点估计的第三个等号，此时我们采用 Taylor 展开的积分型余项
$$
\text{bias}(\hat{p}(x_{0}))=\int_{\mathbb{R}}  K(u)\; \mathrm{d}u\int^{1}_{0}p^{(l)}(x_{0}+\tau uh) \frac{(1-\tau)^{l-1}}{(l-1)!}  \; \mathrm{d}\tau 
$$
此时记
$$
g(u,x)=K(u)\int^{1}_{0}p^{(l)}(x+\tau uh) \frac{(1-\tau)^{l-1}(uh)^{l}}{(l-1)!}  \; \mathrm{d}\tau
$$
并使用 Minkovski 不等式可得
$$
\begin{align}
\left\| \text{bias}(\hat{p}) \right\|^{2}&=	\int_{\mathbb{R}} \left\| g(\cdot,x) \right\|^{2} \; \mathrm{d}x\leq \left( \int_{\mathbb{R}} \left\| g(u,\cdot) \right\|  \; \mathrm{d}u  \right) ^{2}\\
\end{align}
$$
再记 $f(\tau,x)=\big( p^{(l)}(x+\tau uh)-p^{(l)}(x) \big)(1-\tau)^{l-1}$，同样由于 $K$ 是 $l$ 阶核，而多减的一项不含 $u$，故不产生影响。从而
$$
\begin{align}
\left\| \text{bias}(\hat{p}) \right\|^{2}&\leq \left( \int_{\mathbb{R}} \left\| g(u,\cdot) \right\|  \; \mathrm{d}u  \right) ^{2}\\
&=\left( \int_{\mathbb{R}} \frac{\left| K(u) \right| \left| uh \right| ^{l}}{(l-1)!} \left( \int_{\mathbb{R}} \left\| f(\cdot,x) \right\|^{2}  \; \mathrm{d}x  \right)^{\frac{1}{2}}   \; \mathrm{d}u \right)^{2} \\
{\scriptsize(\text{Minkovski})}&\leq \left( \int_{\mathbb{R}} \frac{\left| K(u) \right| \left| uh \right| ^{l}}{(l-1)!} \left( \int_{0}^{1} \left\| f(\tau,\cdot) \right\|  \; \mathrm{d}\tau  \right) \; \mathrm{d}u \right)^{2}\\
\end{align}
$$
由于 $p$ 属于 Nikol'ski 类
$$
\begin{align}
\left\| f(\tau,\cdot) \right\| ^{2} &=(1-\tau)^{2(l-1)}\int_{\mathbb{R}}\big( p^{(l)}(x+\tau uh)-p^{(l)}(x) \big)^{2}   \; \mathrm{d}x \\
{\scriptsize (p \in \mathcal{H}^{\beta})}&\leq (1-\tau)^{2(l-1)}L\left| \tau uh \right| ^{2(\beta-l)}

\end{align}
$$
代入上式得到估计
$$
\left\| \text{bias}(\hat{p}) \right\|^{2}\leq \left( \frac{Lh^{\beta}}{l!}\int_{\mathbb{R}} |u^{\beta}||K(u)|  \; \mathrm{d}u\right) ^{2} 
$$

我们将以上四个估计的阶数总结为下表

|      | $\text{bias}$  |   $\text{Var}$    |
| :--: | :------------: | :---------------: |
|  逐点  | $O(h^{\beta})$ | $O(\frac{1}{nh})$ |
| 积分平均 | $O(h^{\beta})$ | $O(\frac{1}{nh})$ |

为了均方误差 $\mathbb{E}(\hat{p}-p)^{2}$ 尽可能小（不论是逐点意义下还是积分平均意义下），取方差-偏差平均，即 $n^{-1}h^{-1}\sim h^{2\beta}$，得 $h=O(n^{-\frac{1}{2\beta+1}})$ 为**最优窗宽**，此时误差的阶为 $O(n^{-\frac{2\beta}{2\beta+1}})$ 。

最后提一嘴，如果要估计一个随机向量的联合分布密度，则可以采用乘积核或者径向核，收敛速度也会受到维数 $d$ 的影响，当 $d\geq2$ 时表现极差，一般不使用。

---
*Reference:* [[回归分析与线性模型第二章.pdf]]

---
*2025-9-25*